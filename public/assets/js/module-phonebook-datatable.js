"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright Â© 2017-2024 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global globalRootUrl, globalTranslate, SemanticLocalization, UserMessage, InputMaskPatterns */
var ModulePhoneBookDT = {
  // Cached DOM elements
  $disableInputMaskToggle: $('#disable-input-mask'),
  $globalSearch: $('#globalsearch'),
  $recordsTable: $('#phonebook-table'),
  $addNewButton: $('#add-new-button'),
  inputNumberJQTPL: 'input.number-input',
  $maskList: null,
  // URLs for AJAX requests
  getNewRecordsAJAXUrl: "".concat(globalRootUrl, "module-phone-book/getNewRecords"),
  deleteRecordAJAXUrl: "".concat(globalRootUrl, "module-phone-book/delete"),
  saveRecordAJAXUrl: "".concat(globalRootUrl, "module-phone-book/save"),

  /**
   * Initialize the module
   */
  initialize: function initialize() {
    this.initializeSearch();
    this.initializeDataTable();
    this.initializeEventListeners();
  },

  /**
   * Initialize the search functionality
   */
  initializeSearch: function initializeSearch() {
    var _this = this;

    this.$globalSearch.on('keyup', function (e) {
      var searchText = _this.$globalSearch.val().trim();

      if (e.keyCode === 13 || e.keyCode === 8 || searchText.length === 0) {
        _this.applyFilter(searchText);
      }
    });
  },

  /**
   * Initialize all event listeners
   */
  initializeEventListeners: function initializeEventListeners() {
    var _this2 = this;

    var $body = $('body'); // Double-click on input field for editing

    $body.on('focusin', '.caller-id-input, .number-input', function (e) {
      _this2.onFieldFocus($(e.target));
    }); // Input field loses focus - send changes

    $body.on('focusout', '.caller-id-input, .number-input', function () {
      _this2.saveChangesForAllRows();
    }); // Delete button click event

    $body.on('click', 'a.delete', function (e) {
      e.preventDefault();
      var id = $(e.target).closest('a').data('value');

      _this2.deleteRow($(e.target), id);
    }); // Handle Enter or Tab key for form submission

    $(document).on('keydown', function (e) {
      if (e.key === 'Enter' || e.key === 'Tab' && !$(':focus').hasClass('.number-input')) {
        _this2.saveChangesForAllRows();
      }
    }); // Add new row button click

    this.$addNewButton.on('click', function (e) {
      e.preventDefault();

      _this2.addNewRow();
    });
  },

  /**
   * Handle focus on an input field
   */
  onFieldFocus: function onFieldFocus($input) {
    $input.transition('glow');
    $input.closest('div').removeClass('transparent').addClass('changed-field');
    $input.attr('readonly', false);
  },

  /**
   * Save changes for all rows
   */
  saveChangesForAllRows: function saveChangesForAllRows() {
    var _this3 = this;

    var $rows = $('.changed-field').closest('tr');
    $rows.each(function (_, row) {
      var rowId = $(row).attr('id');

      if (rowId !== undefined) {
        _this3.sendChangesToServer(rowId);
      }
    });
  },

  /**
   * Add a new row to the phonebook table
   */
  addNewRow: function addNewRow() {
    var $emptyRow = $('.dataTables_empty');
    if ($emptyRow.length) $emptyRow.remove();
    this.saveChangesForAllRows();
    var newId = "new".concat(Math.floor(Math.random() * 500));
    var newRowTemplate = "\n            <tr id=\"".concat(newId, "\">\n                <td><i class=\"ui user circle icon\"></i></td>\n                <td><div class=\"ui fluid input inline-edit changed-field\"><input class=\"caller-id-input\" type=\"text\" value=\"\"></div></td>\n                <td><div class=\"ui fluid input inline-edit changed-field\"><input class=\"number-input\" type=\"text\" value=\"\"></div></td>\n                <td><div class=\"ui small basic icon buttons action-buttons\">\n                    <a href=\"#\" class=\"ui button delete two-steps-delete popuped\" data-value=\"new\">\n                        <i class=\"icon trash red\"></i>\n                    </a>\n                </div></td>\n            </tr>");
    this.$recordsTable.find('tbody').prepend(newRowTemplate);
    var $newRow = $("#".concat(newId));
    $newRow.find('input').transition('glow');
    $newRow.find('.caller-id-input').focus();
    this.initializeInputmask($newRow.find('.number-input'));
  },

  /**
   * Initialize the DataTable
   */
  initializeDataTable: function initializeDataTable() {
    var _this4 = this;

    this.$recordsTable.dataTable({
      search: {
        search: this.$globalSearch.val()
      },
      serverSide: true,
      processing: true,
      ajax: {
        url: this.getNewRecordsAJAXUrl,
        type: 'POST',
        dataSrc: 'data'
      },
      columns: [{
        data: null
      }, {
        data: 'call_id'
      }, {
        data: 'number'
      }, {
        data: null
      }],
      paging: true,
      pageLength: 17,
      deferRender: true,
      sDom: 'rtip',
      ordering: false,
      createdRow: function createdRow(row, data) {
        _this4.buildRowTemplate(row, data);
      },
      drawCallback: function drawCallback() {
        _this4.initializeInputmask($(_this4.inputNumberJQTPL));
      },
      language: SemanticLocalization.dataTableLocalisation
    });
    this.dataTable = this.$recordsTable.DataTable();
    this.dataTable.on('draw', function () {
      _this4.$globalSearch.closest('div').removeClass('loading');
    });
  },

  /**
   * Build the HTML structure for each row
   */
  buildRowTemplate: function buildRowTemplate(row, data) {
    var nameTemplate = "\n            <div class=\"ui transparent fluid input inline-edit\">\n                <input class=\"caller-id-input\" type=\"text\" value=\"".concat(data.call_id, "\" />\n            </div>");
    var numberTemplate = "\n            <div class=\"ui transparent input inline-edit\">\n                <input class=\"number-input\" type=\"text\" value=\"".concat(data.number, "\" />\n            </div>");
    var deleteButtonTemplate = "\n            <div class=\"ui small basic icon buttons action-buttons\">\n                <a href=\"".concat(this.deleteRecordAJAXUrl, "/").concat(data.DT_RowId, "\" class=\"ui button delete two-steps-delete popuped\">\n                    <i class=\"icon trash red\"></i>\n                </a>\n            </div>");
    $('td', row).eq(0).html('<i class="ui user circle icon"></i>');
    $('td', row).eq(1).html(nameTemplate);
    $('td', row).eq(2).html(numberTemplate);
    $('td', row).eq(3).html(deleteButtonTemplate);
  },

  /**
   * Apply a filter to the DataTable
   * @param {string} text
   */
  applyFilter: function applyFilter(text) {
    var $changedFields = $('.changed-field');
    $changedFields.each(function (_, obj) {
      var $input = $(obj).find('input');
      $input.val($input.data('value'));
      $input.attr('readonly', true);
      $(obj).removeClass('changed-field').addClass('transparent');
    });
    this.dataTable.search(text).draw();
    this.$globalSearch.closest('div').addClass('loading');
  },

  /**
   * Initialize input masks for phone numbers
   */
  initializeInputmask: function initializeInputmask($el) {
    if (this.$disableInputMaskToggle.checkbox('is checked')) return;

    if (this.$maskList === null) {
      this.$maskList = $.masksSort(InputMaskPatterns, ['#'], /[0-9]|#/, 'mask');
    }

    $el.inputmasks({
      inputmask: {
        definitions: {
          '#': {
            validator: '[0-9]',
            cardinality: 1
          }
        },
        showMaskOnHover: false,
        onBeforePaste: this.cbOnNumberBeforePaste
      },
      match: /[0-9]/,
      replace: '9',
      list: this.$maskList,
      listKey: 'mask'
    });
  },

  /**
   * Send the changes for a specific row to the server
   * @param {string} recordId
   */
  sendChangesToServer: function sendChangesToServer(recordId) {
    var _this5 = this;

    var callerId = $("tr#".concat(recordId, " .caller-id-input")).val();
    var numberInputVal = $("tr#".concat(recordId, " .number-input")).val();
    if (!callerId || !numberInputVal) return;
    var number = numberInputVal.replace(/\D+/g, '');
    number = "1".concat(number.substr(number.length - 9));
    var data = {
      call_id: callerId,
      number_rep: numberInputVal,
      number: number,
      id: recordId
    };
    this.displaySavingIcon(recordId);
    $.api({
      url: this.saveRecordAJAXUrl,
      method: 'POST',
      data: data,
      successTest: function successTest(response) {
        return response && response.success === true;
      },
      onSuccess: function onSuccess(response) {
        return _this5.onSaveSuccess(response, recordId);
      },
      onFailure: function onFailure(response) {
        return UserMessage.showMultiString(response.message);
      },
      onError: function onError(errorMessage, element, xhr) {
        if (xhr.status === 403) window.location = "".concat(globalRootUrl, "session/index");
      }
    });
  },

  /**
   * Display saving icon for a specific row
   */
  displaySavingIcon: function displaySavingIcon(recordId) {
    $("tr#".concat(recordId, " .user.circle")).removeClass('user circle').addClass('spinner loading');
  },

  /**
   * Handle success of saving a record
   */
  onSaveSuccess: function onSaveSuccess(response, recordId) {
    if (response.data) {
      var oldId = response.data.oldId || recordId;
      $("tr#".concat(oldId, " input")).attr('readonly', true);
      $("tr#".concat(oldId, " div")).removeClass('changed-field loading').addClass('transparent');
      $("tr#".concat(oldId, " .spinner.loading")).addClass('user circle').removeClass('spinner loading');

      if (oldId !== response.data.newId) {
        $("tr#".concat(oldId)).attr('id', response.data.newId);
      }
    }
  },

  /**
   * Delete a row from the phonebook
   * @param {jQuery} $target
   * @param {string} id
   */
  deleteRow: function deleteRow($target, id) {
    var _this6 = this;

    if (id === 'new') {
      $target.closest('tr').remove();
      return;
    }

    $.api({
      url: "".concat(this.deleteRecordAJAXUrl, "/").concat(id),
      on: 'now',
      onSuccess: function onSuccess(response) {
        if (response.success) {
          $target.closest('tr').remove();

          if (_this6.$recordsTable.find('tbody > tr').length === 0) {
            _this6.$recordsTable.find('tbody').append('<tr class="odd"></tr>');
          }
        }
      }
    });
  },

  /**
   * Clean number before pasting
   * @returns {string}
   */
  cbOnNumberBeforePaste: function cbOnNumberBeforePaste(pastedValue) {
    return pastedValue.replace(/\D+/g, '');
  }
};
$(document).ready(function () {
  ModulePhoneBookDT.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9tb2R1bGUtcGhvbmVib29rLWRhdGF0YWJsZS5qcyJdLCJuYW1lcyI6WyJNb2R1bGVQaG9uZUJvb2tEVCIsIiRkaXNhYmxlSW5wdXRNYXNrVG9nZ2xlIiwiJCIsIiRnbG9iYWxTZWFyY2giLCIkcmVjb3Jkc1RhYmxlIiwiJGFkZE5ld0J1dHRvbiIsImlucHV0TnVtYmVySlFUUEwiLCIkbWFza0xpc3QiLCJnZXROZXdSZWNvcmRzQUpBWFVybCIsImdsb2JhbFJvb3RVcmwiLCJkZWxldGVSZWNvcmRBSkFYVXJsIiwic2F2ZVJlY29yZEFKQVhVcmwiLCJpbml0aWFsaXplIiwiaW5pdGlhbGl6ZVNlYXJjaCIsImluaXRpYWxpemVEYXRhVGFibGUiLCJpbml0aWFsaXplRXZlbnRMaXN0ZW5lcnMiLCJvbiIsImUiLCJzZWFyY2hUZXh0IiwidmFsIiwidHJpbSIsImtleUNvZGUiLCJsZW5ndGgiLCJhcHBseUZpbHRlciIsIiRib2R5Iiwib25GaWVsZEZvY3VzIiwidGFyZ2V0Iiwic2F2ZUNoYW5nZXNGb3JBbGxSb3dzIiwicHJldmVudERlZmF1bHQiLCJpZCIsImNsb3Nlc3QiLCJkYXRhIiwiZGVsZXRlUm93IiwiZG9jdW1lbnQiLCJrZXkiLCJoYXNDbGFzcyIsImFkZE5ld1JvdyIsIiRpbnB1dCIsInRyYW5zaXRpb24iLCJyZW1vdmVDbGFzcyIsImFkZENsYXNzIiwiYXR0ciIsIiRyb3dzIiwiZWFjaCIsIl8iLCJyb3ciLCJyb3dJZCIsInVuZGVmaW5lZCIsInNlbmRDaGFuZ2VzVG9TZXJ2ZXIiLCIkZW1wdHlSb3ciLCJyZW1vdmUiLCJuZXdJZCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsIm5ld1Jvd1RlbXBsYXRlIiwiZmluZCIsInByZXBlbmQiLCIkbmV3Um93IiwiZm9jdXMiLCJpbml0aWFsaXplSW5wdXRtYXNrIiwiZGF0YVRhYmxlIiwic2VhcmNoIiwic2VydmVyU2lkZSIsInByb2Nlc3NpbmciLCJhamF4IiwidXJsIiwidHlwZSIsImRhdGFTcmMiLCJjb2x1bW5zIiwicGFnaW5nIiwicGFnZUxlbmd0aCIsImRlZmVyUmVuZGVyIiwic0RvbSIsIm9yZGVyaW5nIiwiY3JlYXRlZFJvdyIsImJ1aWxkUm93VGVtcGxhdGUiLCJkcmF3Q2FsbGJhY2siLCJsYW5ndWFnZSIsIlNlbWFudGljTG9jYWxpemF0aW9uIiwiZGF0YVRhYmxlTG9jYWxpc2F0aW9uIiwiRGF0YVRhYmxlIiwibmFtZVRlbXBsYXRlIiwiY2FsbF9pZCIsIm51bWJlclRlbXBsYXRlIiwibnVtYmVyIiwiZGVsZXRlQnV0dG9uVGVtcGxhdGUiLCJEVF9Sb3dJZCIsImVxIiwiaHRtbCIsInRleHQiLCIkY2hhbmdlZEZpZWxkcyIsIm9iaiIsImRyYXciLCIkZWwiLCJjaGVja2JveCIsIm1hc2tzU29ydCIsIklucHV0TWFza1BhdHRlcm5zIiwiaW5wdXRtYXNrcyIsImlucHV0bWFzayIsImRlZmluaXRpb25zIiwidmFsaWRhdG9yIiwiY2FyZGluYWxpdHkiLCJzaG93TWFza09uSG92ZXIiLCJvbkJlZm9yZVBhc3RlIiwiY2JPbk51bWJlckJlZm9yZVBhc3RlIiwibWF0Y2giLCJyZXBsYWNlIiwibGlzdCIsImxpc3RLZXkiLCJyZWNvcmRJZCIsImNhbGxlcklkIiwibnVtYmVySW5wdXRWYWwiLCJzdWJzdHIiLCJudW1iZXJfcmVwIiwiZGlzcGxheVNhdmluZ0ljb24iLCJhcGkiLCJtZXRob2QiLCJzdWNjZXNzVGVzdCIsInJlc3BvbnNlIiwic3VjY2VzcyIsIm9uU3VjY2VzcyIsIm9uU2F2ZVN1Y2Nlc3MiLCJvbkZhaWx1cmUiLCJVc2VyTWVzc2FnZSIsInNob3dNdWx0aVN0cmluZyIsIm1lc3NhZ2UiLCJvbkVycm9yIiwiZXJyb3JNZXNzYWdlIiwiZWxlbWVudCIsInhociIsInN0YXR1cyIsIndpbmRvdyIsImxvY2F0aW9uIiwib2xkSWQiLCIkdGFyZ2V0IiwiYXBwZW5kIiwicGFzdGVkVmFsdWUiLCJyZWFkeSJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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QUFaLENBQWtCLFlBQU07QUFDcEIxSSxFQUFBQSxpQkFBaUIsQ0FBQ1ksVUFBbEI7QUFDSCxDQUZEIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIE1pa29QQlggLSBmcmVlIHBob25lIHN5c3RlbSBmb3Igc21hbGwgYnVzaW5lc3NcbiAqIENvcHlyaWdodCDCqSAyMDE3LTIwMjQgQWxleGV5IFBvcnRub3YgYW5kIE5pa29sYXkgQmVrZXRvdlxuICpcbiAqIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS5cbiAqIElmIG5vdCwgc2VlIDxodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKi9cblxuLyogZ2xvYmFsIGdsb2JhbFJvb3RVcmwsIGdsb2JhbFRyYW5zbGF0ZSwgU2VtYW50aWNMb2NhbGl6YXRpb24sIFVzZXJNZXNzYWdlLCBJbnB1dE1hc2tQYXR0ZXJucyAqL1xuXG5jb25zdCBNb2R1bGVQaG9uZUJvb2tEVCA9IHtcbiAgICAvLyBDYWNoZWQgRE9NIGVsZW1lbnRzXG4gICAgJGRpc2FibGVJbnB1dE1hc2tUb2dnbGU6ICQoJyNkaXNhYmxlLWlucHV0LW1hc2snKSxcbiAgICAkZ2xvYmFsU2VhcmNoOiAkKCcjZ2xvYmFsc2VhcmNoJyksXG4gICAgJHJlY29yZHNUYWJsZTogJCgnI3Bob25lYm9vay10YWJsZScpLFxuICAgICRhZGROZXdCdXR0b246ICQoJyNhZGQtbmV3LWJ1dHRvbicpLFxuICAgIGlucHV0TnVtYmVySlFUUEw6ICdpbnB1dC5udW1iZXItaW5wdXQnLFxuICAgICRtYXNrTGlzdDogbnVsbCxcblxuICAgIC8vIFVSTHMgZm9yIEFKQVggcmVxdWVzdHNcbiAgICBnZXROZXdSZWNvcmRzQUpBWFVybDogYCR7Z2xvYmFsUm9vdFVybH1tb2R1bGUtcGhvbmUtYm9vay9nZXROZXdSZWNvcmRzYCxcbiAgICBkZWxldGVSZWNvcmRBSkFYVXJsOiBgJHtnbG9iYWxSb290VXJsfW1vZHVsZS1waG9uZS1ib29rL2RlbGV0ZWAsXG4gICAgc2F2ZVJlY29yZEFKQVhVcmw6IGAke2dsb2JhbFJvb3RVcmx9bW9kdWxlLXBob25lLWJvb2svc2F2ZWAsXG5cbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplIHRoZSBtb2R1bGVcbiAgICAgKi9cbiAgICBpbml0aWFsaXplKCkge1xuICAgICAgICB0aGlzLmluaXRpYWxpemVTZWFyY2goKTtcbiAgICAgICAgdGhpcy5pbml0aWFsaXplRGF0YVRhYmxlKCk7XG4gICAgICAgIHRoaXMuaW5pdGlhbGl6ZUV2ZW50TGlzdGVuZXJzKCk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEluaXRpYWxpemUgdGhlIHNlYXJjaCBmdW5jdGlvbmFsaXR5XG4gICAgICovXG4gICAgaW5pdGlhbGl6ZVNlYXJjaCgpIHtcbiAgICAgICAgdGhpcy4kZ2xvYmFsU2VhcmNoLm9uKCdrZXl1cCcsIChlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzZWFyY2hUZXh0ID0gdGhpcy4kZ2xvYmFsU2VhcmNoLnZhbCgpLnRyaW0oKTtcbiAgICAgICAgICAgIGlmIChlLmtleUNvZGUgPT09IDEzIHx8IGUua2V5Q29kZSA9PT0gOCB8fCBzZWFyY2hUZXh0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuYXBwbHlGaWx0ZXIoc2VhcmNoVGV4dCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplIGFsbCBldmVudCBsaXN0ZW5lcnNcbiAgICAgKi9cbiAgICBpbml0aWFsaXplRXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgICAgIGNvbnN0ICRib2R5ID0gJCgnYm9keScpO1xuXG4gICAgICAgIC8vIERvdWJsZS1jbGljayBvbiBpbnB1dCBmaWVsZCBmb3IgZWRpdGluZ1xuICAgICAgICAkYm9keS5vbignZm9jdXNpbicsICcuY2FsbGVyLWlkLWlucHV0LCAubnVtYmVyLWlucHV0JywgKGUpID0+IHtcbiAgICAgICAgICAgIHRoaXMub25GaWVsZEZvY3VzKCQoZS50YXJnZXQpKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gSW5wdXQgZmllbGQgbG9zZXMgZm9jdXMgLSBzZW5kIGNoYW5nZXNcbiAgICAgICAgJGJvZHkub24oJ2ZvY3Vzb3V0JywgJy5jYWxsZXItaWQtaW5wdXQsIC5udW1iZXItaW5wdXQnLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNhdmVDaGFuZ2VzRm9yQWxsUm93cygpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBEZWxldGUgYnV0dG9uIGNsaWNrIGV2ZW50XG4gICAgICAgICRib2R5Lm9uKCdjbGljaycsICdhLmRlbGV0ZScsIChlKSA9PiB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBjb25zdCBpZCA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoJ2EnKS5kYXRhKCd2YWx1ZScpO1xuICAgICAgICAgICAgdGhpcy5kZWxldGVSb3coJChlLnRhcmdldCksIGlkKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gSGFuZGxlIEVudGVyIG9yIFRhYiBrZXkgZm9yIGZvcm0gc3VibWlzc2lvblxuICAgICAgICAkKGRvY3VtZW50KS5vbigna2V5ZG93bicsIChlKSA9PiB7XG4gICAgICAgICAgICBpZiAoZS5rZXkgPT09ICdFbnRlcicgfHwgKGUua2V5ID09PSAnVGFiJyAmJiAhJCgnOmZvY3VzJykuaGFzQ2xhc3MoJy5udW1iZXItaW5wdXQnKSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNhdmVDaGFuZ2VzRm9yQWxsUm93cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBBZGQgbmV3IHJvdyBidXR0b24gY2xpY2tcbiAgICAgICAgdGhpcy4kYWRkTmV3QnV0dG9uLm9uKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB0aGlzLmFkZE5ld1JvdygpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogSGFuZGxlIGZvY3VzIG9uIGFuIGlucHV0IGZpZWxkXG4gICAgICovXG4gICAgb25GaWVsZEZvY3VzKCRpbnB1dCkge1xuICAgICAgICAkaW5wdXQudHJhbnNpdGlvbignZ2xvdycpO1xuICAgICAgICAkaW5wdXQuY2xvc2VzdCgnZGl2JykucmVtb3ZlQ2xhc3MoJ3RyYW5zcGFyZW50JykuYWRkQ2xhc3MoJ2NoYW5nZWQtZmllbGQnKTtcbiAgICAgICAgJGlucHV0LmF0dHIoJ3JlYWRvbmx5JywgZmFsc2UpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBTYXZlIGNoYW5nZXMgZm9yIGFsbCByb3dzXG4gICAgICovXG4gICAgc2F2ZUNoYW5nZXNGb3JBbGxSb3dzKCkge1xuICAgICAgICBjb25zdCAkcm93cyA9ICQoJy5jaGFuZ2VkLWZpZWxkJykuY2xvc2VzdCgndHInKTtcbiAgICAgICAgJHJvd3MuZWFjaCgoXywgcm93KSA9PiB7XG4gICAgICAgICAgICBjb25zdCByb3dJZCA9ICQocm93KS5hdHRyKCdpZCcpO1xuICAgICAgICAgICAgaWYgKHJvd0lkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbmRDaGFuZ2VzVG9TZXJ2ZXIocm93SWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQWRkIGEgbmV3IHJvdyB0byB0aGUgcGhvbmVib29rIHRhYmxlXG4gICAgICovXG4gICAgYWRkTmV3Um93KCkge1xuICAgICAgICBjb25zdCAkZW1wdHlSb3cgPSAkKCcuZGF0YVRhYmxlc19lbXB0eScpO1xuICAgICAgICBpZiAoJGVtcHR5Um93Lmxlbmd0aCkgJGVtcHR5Um93LnJlbW92ZSgpO1xuXG4gICAgICAgIHRoaXMuc2F2ZUNoYW5nZXNGb3JBbGxSb3dzKCk7XG5cbiAgICAgICAgY29uc3QgbmV3SWQgPSBgbmV3JHtNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA1MDApfWA7XG4gICAgICAgIGNvbnN0IG5ld1Jvd1RlbXBsYXRlID0gYFxuICAgICAgICAgICAgPHRyIGlkPVwiJHtuZXdJZH1cIj5cbiAgICAgICAgICAgICAgICA8dGQ+PGkgY2xhc3M9XCJ1aSB1c2VyIGNpcmNsZSBpY29uXCI+PC9pPjwvdGQ+XG4gICAgICAgICAgICAgICAgPHRkPjxkaXYgY2xhc3M9XCJ1aSBmbHVpZCBpbnB1dCBpbmxpbmUtZWRpdCBjaGFuZ2VkLWZpZWxkXCI+PGlucHV0IGNsYXNzPVwiY2FsbGVyLWlkLWlucHV0XCIgdHlwZT1cInRleHRcIiB2YWx1ZT1cIlwiPjwvZGl2PjwvdGQ+XG4gICAgICAgICAgICAgICAgPHRkPjxkaXYgY2xhc3M9XCJ1aSBmbHVpZCBpbnB1dCBpbmxpbmUtZWRpdCBjaGFuZ2VkLWZpZWxkXCI+PGlucHV0IGNsYXNzPVwibnVtYmVyLWlucHV0XCIgdHlwZT1cInRleHRcIiB2YWx1ZT1cIlwiPjwvZGl2PjwvdGQ+XG4gICAgICAgICAgICAgICAgPHRkPjxkaXYgY2xhc3M9XCJ1aSBzbWFsbCBiYXNpYyBpY29uIGJ1dHRvbnMgYWN0aW9uLWJ1dHRvbnNcIj5cbiAgICAgICAgICAgICAgICAgICAgPGEgaHJlZj1cIiNcIiBjbGFzcz1cInVpIGJ1dHRvbiBkZWxldGUgdHdvLXN0ZXBzLWRlbGV0ZSBwb3B1cGVkXCIgZGF0YS12YWx1ZT1cIm5ld1wiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9XCJpY29uIHRyYXNoIHJlZFwiPjwvaT5cbiAgICAgICAgICAgICAgICAgICAgPC9hPlxuICAgICAgICAgICAgICAgIDwvZGl2PjwvdGQ+XG4gICAgICAgICAgICA8L3RyPmA7XG5cbiAgICAgICAgdGhpcy4kcmVjb3Jkc1RhYmxlLmZpbmQoJ3Rib2R5JykucHJlcGVuZChuZXdSb3dUZW1wbGF0ZSk7XG4gICAgICAgIGNvbnN0ICRuZXdSb3cgPSAkKGAjJHtuZXdJZH1gKTtcbiAgICAgICAgJG5ld1Jvdy5maW5kKCdpbnB1dCcpLnRyYW5zaXRpb24oJ2dsb3cnKTtcbiAgICAgICAgJG5ld1Jvdy5maW5kKCcuY2FsbGVyLWlkLWlucHV0JykuZm9jdXMoKTtcbiAgICAgICAgdGhpcy5pbml0aWFsaXplSW5wdXRtYXNrKCRuZXdSb3cuZmluZCgnLm51bWJlci1pbnB1dCcpKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogSW5pdGlhbGl6ZSB0aGUgRGF0YVRhYmxlXG4gICAgICovXG4gICAgaW5pdGlhbGl6ZURhdGFUYWJsZSgpIHtcbiAgICAgICAgdGhpcy4kcmVjb3Jkc1RhYmxlLmRhdGFUYWJsZSh7XG4gICAgICAgICAgICBzZWFyY2g6IHsgc2VhcmNoOiB0aGlzLiRnbG9iYWxTZWFyY2gudmFsKCkgfSxcbiAgICAgICAgICAgIHNlcnZlclNpZGU6IHRydWUsXG4gICAgICAgICAgICBwcm9jZXNzaW5nOiB0cnVlLFxuICAgICAgICAgICAgYWpheDoge1xuICAgICAgICAgICAgICAgIHVybDogdGhpcy5nZXROZXdSZWNvcmRzQUpBWFVybCxcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgZGF0YVNyYzogJ2RhdGEnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbHVtbnM6IFtcbiAgICAgICAgICAgICAgICB7IGRhdGE6IG51bGwgfSxcbiAgICAgICAgICAgICAgICB7IGRhdGE6ICdjYWxsX2lkJyB9LFxuICAgICAgICAgICAgICAgIHsgZGF0YTogJ251bWJlcicgfSxcbiAgICAgICAgICAgICAgICB7IGRhdGE6IG51bGwgfSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBwYWdpbmc6IHRydWUsXG4gICAgICAgICAgICBwYWdlTGVuZ3RoOiAxNyxcbiAgICAgICAgICAgIGRlZmVyUmVuZGVyOiB0cnVlLFxuICAgICAgICAgICAgc0RvbTogJ3J0aXAnLFxuICAgICAgICAgICAgb3JkZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgY3JlYXRlZFJvdzogKHJvdywgZGF0YSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYnVpbGRSb3dUZW1wbGF0ZShyb3csIGRhdGEpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRyYXdDYWxsYmFjazogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuaW5pdGlhbGl6ZUlucHV0bWFzaygkKHRoaXMuaW5wdXROdW1iZXJKUVRQTCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxhbmd1YWdlOiBTZW1hbnRpY0xvY2FsaXphdGlvbi5kYXRhVGFibGVMb2NhbGlzYXRpb24sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuZGF0YVRhYmxlID0gdGhpcy4kcmVjb3Jkc1RhYmxlLkRhdGFUYWJsZSgpO1xuXG4gICAgICAgIHRoaXMuZGF0YVRhYmxlLm9uKCdkcmF3JywgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy4kZ2xvYmFsU2VhcmNoLmNsb3Nlc3QoJ2RpdicpLnJlbW92ZUNsYXNzKCdsb2FkaW5nJyk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBCdWlsZCB0aGUgSFRNTCBzdHJ1Y3R1cmUgZm9yIGVhY2ggcm93XG4gICAgICovXG4gICAgYnVpbGRSb3dUZW1wbGF0ZShyb3csIGRhdGEpIHtcbiAgICAgICAgY29uc3QgbmFtZVRlbXBsYXRlID0gYFxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInVpIHRyYW5zcGFyZW50IGZsdWlkIGlucHV0IGlubGluZS1lZGl0XCI+XG4gICAgICAgICAgICAgICAgPGlucHV0IGNsYXNzPVwiY2FsbGVyLWlkLWlucHV0XCIgdHlwZT1cInRleHRcIiB2YWx1ZT1cIiR7ZGF0YS5jYWxsX2lkfVwiIC8+XG4gICAgICAgICAgICA8L2Rpdj5gO1xuICAgICAgICBjb25zdCBudW1iZXJUZW1wbGF0ZSA9IGBcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJ1aSB0cmFuc3BhcmVudCBpbnB1dCBpbmxpbmUtZWRpdFwiPlxuICAgICAgICAgICAgICAgIDxpbnB1dCBjbGFzcz1cIm51bWJlci1pbnB1dFwiIHR5cGU9XCJ0ZXh0XCIgdmFsdWU9XCIke2RhdGEubnVtYmVyfVwiIC8+XG4gICAgICAgICAgICA8L2Rpdj5gO1xuICAgICAgICBjb25zdCBkZWxldGVCdXR0b25UZW1wbGF0ZSA9IGBcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJ1aSBzbWFsbCBiYXNpYyBpY29uIGJ1dHRvbnMgYWN0aW9uLWJ1dHRvbnNcIj5cbiAgICAgICAgICAgICAgICA8YSBocmVmPVwiJHt0aGlzLmRlbGV0ZVJlY29yZEFKQVhVcmx9LyR7ZGF0YS5EVF9Sb3dJZH1cIiBjbGFzcz1cInVpIGJ1dHRvbiBkZWxldGUgdHdvLXN0ZXBzLWRlbGV0ZSBwb3B1cGVkXCI+XG4gICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPVwiaWNvbiB0cmFzaCByZWRcIj48L2k+XG4gICAgICAgICAgICAgICAgPC9hPlxuICAgICAgICAgICAgPC9kaXY+YDtcblxuICAgICAgICAkKCd0ZCcsIHJvdykuZXEoMCkuaHRtbCgnPGkgY2xhc3M9XCJ1aSB1c2VyIGNpcmNsZSBpY29uXCI+PC9pPicpO1xuICAgICAgICAkKCd0ZCcsIHJvdykuZXEoMSkuaHRtbChuYW1lVGVtcGxhdGUpO1xuICAgICAgICAkKCd0ZCcsIHJvdykuZXEoMikuaHRtbChudW1iZXJUZW1wbGF0ZSk7XG4gICAgICAgICQoJ3RkJywgcm93KS5lcSgzKS5odG1sKGRlbGV0ZUJ1dHRvblRlbXBsYXRlKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQXBwbHkgYSBmaWx0ZXIgdG8gdGhlIERhdGFUYWJsZVxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0ZXh0XG4gICAgICovXG4gICAgYXBwbHlGaWx0ZXIodGV4dCkge1xuICAgICAgICBjb25zdCAkY2hhbmdlZEZpZWxkcyA9ICQoJy5jaGFuZ2VkLWZpZWxkJyk7XG4gICAgICAgICRjaGFuZ2VkRmllbGRzLmVhY2goKF8sIG9iaikgPT4ge1xuICAgICAgICAgICAgY29uc3QgJGlucHV0ID0gJChvYmopLmZpbmQoJ2lucHV0Jyk7XG4gICAgICAgICAgICAkaW5wdXQudmFsKCRpbnB1dC5kYXRhKCd2YWx1ZScpKTtcbiAgICAgICAgICAgICRpbnB1dC5hdHRyKCdyZWFkb25seScsIHRydWUpO1xuICAgICAgICAgICAgJChvYmopLnJlbW92ZUNsYXNzKCdjaGFuZ2VkLWZpZWxkJykuYWRkQ2xhc3MoJ3RyYW5zcGFyZW50Jyk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmRhdGFUYWJsZS5zZWFyY2godGV4dCkuZHJhdygpO1xuICAgICAgICB0aGlzLiRnbG9iYWxTZWFyY2guY2xvc2VzdCgnZGl2JykuYWRkQ2xhc3MoJ2xvYWRpbmcnKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogSW5pdGlhbGl6ZSBpbnB1dCBtYXNrcyBmb3IgcGhvbmUgbnVtYmVyc1xuICAgICAqL1xuICAgIGluaXRpYWxpemVJbnB1dG1hc2soJGVsKSB7XG4gICAgICAgIGlmICh0aGlzLiRkaXNhYmxlSW5wdXRNYXNrVG9nZ2xlLmNoZWNrYm94KCdpcyBjaGVja2VkJykpIHJldHVybjtcblxuICAgICAgICBpZiAodGhpcy4kbWFza0xpc3QgPT09IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuJG1hc2tMaXN0ID0gJC5tYXNrc1NvcnQoSW5wdXRNYXNrUGF0dGVybnMsIFsnIyddLCAvWzAtOV18Iy8sICdtYXNrJyk7XG4gICAgICAgIH1cblxuICAgICAgICAkZWwuaW5wdXRtYXNrcyh7XG4gICAgICAgICAgICBpbnB1dG1hc2s6IHtcbiAgICAgICAgICAgICAgICBkZWZpbml0aW9uczoge1xuICAgICAgICAgICAgICAgICAgICAnIyc6IHsgdmFsaWRhdG9yOiAnWzAtOV0nLCBjYXJkaW5hbGl0eTogMSB9LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgc2hvd01hc2tPbkhvdmVyOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBvbkJlZm9yZVBhc3RlOiB0aGlzLmNiT25OdW1iZXJCZWZvcmVQYXN0ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtYXRjaDogL1swLTldLyxcbiAgICAgICAgICAgIHJlcGxhY2U6ICc5JyxcbiAgICAgICAgICAgIGxpc3Q6IHRoaXMuJG1hc2tMaXN0LFxuICAgICAgICAgICAgbGlzdEtleTogJ21hc2snLFxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogU2VuZCB0aGUgY2hhbmdlcyBmb3IgYSBzcGVjaWZpYyByb3cgdG8gdGhlIHNlcnZlclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSByZWNvcmRJZFxuICAgICAqL1xuICAgIHNlbmRDaGFuZ2VzVG9TZXJ2ZXIocmVjb3JkSWQpIHtcbiAgICAgICAgY29uc3QgY2FsbGVySWQgPSAkKGB0ciMke3JlY29yZElkfSAuY2FsbGVyLWlkLWlucHV0YCkudmFsKCk7XG4gICAgICAgIGNvbnN0IG51bWJlcklucHV0VmFsID0gJChgdHIjJHtyZWNvcmRJZH0gLm51bWJlci1pbnB1dGApLnZhbCgpO1xuXG4gICAgICAgIGlmICghY2FsbGVySWQgfHwgIW51bWJlcklucHV0VmFsKSByZXR1cm47XG5cbiAgICAgICAgbGV0IG51bWJlciA9IG51bWJlcklucHV0VmFsLnJlcGxhY2UoL1xcRCsvZywgJycpO1xuICAgICAgICBudW1iZXIgPSBgMSR7bnVtYmVyLnN1YnN0cihudW1iZXIubGVuZ3RoIC0gOSl9YDtcblxuICAgICAgICBjb25zdCBkYXRhID0ge1xuICAgICAgICAgICAgY2FsbF9pZDogY2FsbGVySWQsXG4gICAgICAgICAgICBudW1iZXJfcmVwOiBudW1iZXJJbnB1dFZhbCxcbiAgICAgICAgICAgIG51bWJlcixcbiAgICAgICAgICAgIGlkOiByZWNvcmRJZCxcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmRpc3BsYXlTYXZpbmdJY29uKHJlY29yZElkKTtcblxuICAgICAgICAkLmFwaSh7XG4gICAgICAgICAgICB1cmw6IHRoaXMuc2F2ZVJlY29yZEFKQVhVcmwsXG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgIGRhdGEsXG4gICAgICAgICAgICBzdWNjZXNzVGVzdDogKHJlc3BvbnNlKSA9PiByZXNwb25zZSAmJiByZXNwb25zZS5zdWNjZXNzID09PSB0cnVlLFxuICAgICAgICAgICAgb25TdWNjZXNzOiAocmVzcG9uc2UpID0+IHRoaXMub25TYXZlU3VjY2VzcyhyZXNwb25zZSwgcmVjb3JkSWQpLFxuICAgICAgICAgICAgb25GYWlsdXJlOiAocmVzcG9uc2UpID0+IFVzZXJNZXNzYWdlLnNob3dNdWx0aVN0cmluZyhyZXNwb25zZS5tZXNzYWdlKSxcbiAgICAgICAgICAgIG9uRXJyb3I6IChlcnJvck1lc3NhZ2UsIGVsZW1lbnQsIHhocikgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh4aHIuc3RhdHVzID09PSA0MDMpIHdpbmRvdy5sb2NhdGlvbiA9IGAke2dsb2JhbFJvb3RVcmx9c2Vzc2lvbi9pbmRleGA7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogRGlzcGxheSBzYXZpbmcgaWNvbiBmb3IgYSBzcGVjaWZpYyByb3dcbiAgICAgKi9cbiAgICBkaXNwbGF5U2F2aW5nSWNvbihyZWNvcmRJZCkge1xuICAgICAgICAkKGB0ciMke3JlY29yZElkfSAudXNlci5jaXJjbGVgKVxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKCd1c2VyIGNpcmNsZScpXG4gICAgICAgICAgICAuYWRkQ2xhc3MoJ3NwaW5uZXIgbG9hZGluZycpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBIYW5kbGUgc3VjY2VzcyBvZiBzYXZpbmcgYSByZWNvcmRcbiAgICAgKi9cbiAgICBvblNhdmVTdWNjZXNzKHJlc3BvbnNlLCByZWNvcmRJZCkge1xuICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSkge1xuICAgICAgICAgICAgbGV0IG9sZElkID0gcmVzcG9uc2UuZGF0YS5vbGRJZCB8fCByZWNvcmRJZDtcbiAgICAgICAgICAgICQoYHRyIyR7b2xkSWR9IGlucHV0YCkuYXR0cigncmVhZG9ubHknLCB0cnVlKTtcbiAgICAgICAgICAgICQoYHRyIyR7b2xkSWR9IGRpdmApLnJlbW92ZUNsYXNzKCdjaGFuZ2VkLWZpZWxkIGxvYWRpbmcnKS5hZGRDbGFzcygndHJhbnNwYXJlbnQnKTtcbiAgICAgICAgICAgICQoYHRyIyR7b2xkSWR9IC5zcGlubmVyLmxvYWRpbmdgKS5hZGRDbGFzcygndXNlciBjaXJjbGUnKS5yZW1vdmVDbGFzcygnc3Bpbm5lciBsb2FkaW5nJyk7XG4gICAgICAgICAgICBpZiAob2xkSWQgIT09IHJlc3BvbnNlLmRhdGEubmV3SWQpIHtcbiAgICAgICAgICAgICAgICAkKGB0ciMke29sZElkfWApLmF0dHIoJ2lkJywgcmVzcG9uc2UuZGF0YS5uZXdJZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogRGVsZXRlIGEgcm93IGZyb20gdGhlIHBob25lYm9va1xuICAgICAqIEBwYXJhbSB7alF1ZXJ5fSAkdGFyZ2V0XG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGlkXG4gICAgICovXG4gICAgZGVsZXRlUm93KCR0YXJnZXQsIGlkKSB7XG4gICAgICAgIGlmIChpZCA9PT0gJ25ldycpIHtcbiAgICAgICAgICAgICR0YXJnZXQuY2xvc2VzdCgndHInKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgICQuYXBpKHtcbiAgICAgICAgICAgIHVybDogYCR7dGhpcy5kZWxldGVSZWNvcmRBSkFYVXJsfS8ke2lkfWAsXG4gICAgICAgICAgICBvbjogJ25vdycsXG4gICAgICAgICAgICBvblN1Y2Nlc3M6IChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgICR0YXJnZXQuY2xvc2VzdCgndHInKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuJHJlY29yZHNUYWJsZS5maW5kKCd0Ym9keSA+IHRyJykubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRyZWNvcmRzVGFibGUuZmluZCgndGJvZHknKS5hcHBlbmQoJzx0ciBjbGFzcz1cIm9kZFwiPjwvdHI+Jyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQ2xlYW4gbnVtYmVyIGJlZm9yZSBwYXN0aW5nXG4gICAgICogQHJldHVybnMge3N0cmluZ31cbiAgICAgKi9cbiAgICBjYk9uTnVtYmVyQmVmb3JlUGFzdGUocGFzdGVkVmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIHBhc3RlZFZhbHVlLnJlcGxhY2UoL1xcRCsvZywgJycpO1xuICAgIH0sXG59O1xuXG4kKGRvY3VtZW50KS5yZWFkeSgoKSA9PiB7XG4gICAgTW9kdWxlUGhvbmVCb29rRFQuaW5pdGlhbGl6ZSgpO1xufSk7Il19