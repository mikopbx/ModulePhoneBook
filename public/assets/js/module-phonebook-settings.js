"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright Â© 2017-2024 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global globalRootUrl, globalTranslate,
SemanticLocalization, UserMessage, InputMaskPatterns */
var ModulePhoneBookSettings = {
  $disableInputMaskToggle: $('#disable-input-mask'),
  $deleteAllRecordsButton: $('#delete-all-records'),
  $deleteAllModal: $('#delete-all-modal-form'),
  deleteAllRecordsAJAXUrl: "".concat(globalRootUrl, "module-phone-book/module-phone-book/deleteAllRecords"),
  disableInputMaskAJAXUrl: "".concat(globalRootUrl, "module-phone-book/module-phone-book/toggleDisableInputMask"),

  /**
   * Initialize the settings module for the phonebook.
   * It sets up the event listeners for toggling input masks and deleting all records.
   */
  initialize: function initialize() {
    // Hide the delete confirmation modal initially
    ModulePhoneBookSettings.$deleteAllModal.modal('hide'); // Set up the checkbox for disabling/enabling the input mask

    ModulePhoneBookSettings.$disableInputMaskToggle.checkbox({
      onChange: ModulePhoneBookSettings.onChangeInputMaskToggle
    }); // Attach event listener for the "Delete All Records" button

    ModulePhoneBookSettings.$deleteAllRecordsButton.on('click', function () {
      ModulePhoneBookSettings.deleteAllRecords();
    });
  },

  /**
   * Handle the deletion of all records.
   * Displays a confirmation modal, and if approved, sends a request to delete all phonebook records.
   */
  deleteAllRecords: function deleteAllRecords() {
    ModulePhoneBookSettings.$deleteAllModal.modal({
      closable: false,
      // Prevent closing the modal without user action
      onDeny: function onDeny() {
        return true; // Allows modal to close on "Cancel"
      },
      onApprove: function onApprove() {
        ModulePhoneBookSettings.$deleteAllRecordsButton.addClass('loading'); // On approval, send a request to delete all records

        $.api({
          url: ModulePhoneBookSettings.deleteAllRecordsAJAXUrl,
          on: 'now',
          method: 'POST',
          successTest: PbxApi.successTest,
          onSuccess: function onSuccess(response) {
            ModulePhoneBookSettings.$deleteAllRecordsButton.removeClass('loading');
            UserMessage.showInformation(globalTranslate.module_phnbk_AllRecordsDeleted); // Reload the page after successful update

            ModulePhoneBookDT.dataTable.ajax.reload();
          },
          onFailure: function onFailure(response) {
            ModulePhoneBookSettings.$deleteAllRecordsButton.removeClass('loading'); // Show error message if deletion fails

            UserMessage.showMultiString(response.messages);
          }
        });
        return true;
      }
    }).modal('show'); // Display the confirmation modal
  },

  /**
   * Handle the toggle of the input mask.
   * Sends a request to update the setting for enabling or disabling input masks.
   */
  onChangeInputMaskToggle: function onChangeInputMaskToggle() {
    var currentState = ModulePhoneBookSettings.$disableInputMaskToggle.checkbox('is checked'); // Send request to toggle the input mask setting

    $.api({
      url: ModulePhoneBookSettings.disableInputMaskAJAXUrl,
      on: 'now',
      method: 'POST',
      data: {
        disableInputMask: currentState
      },
      successTest: PbxApi.successTest,
      onSuccess: function onSuccess(response) {
        window.location.reload();
      },
      onFailure: function onFailure(response) {
        // Show error message if the update fails
        UserMessage.showMultiString(response.messages);
      }
    });
    return true;
  }
}; // Initialize the settings module when the document is ready

$(document).ready(function () {
  ModulePhoneBookSettings.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9tb2R1bGUtcGhvbmVib29rLXNldHRpbmdzLmpzIl0sIm5hbWVzIjpbIk1vZHVsZVBob25lQm9va1NldHRpbmdzIiwiJGRpc2FibGVJbnB1dE1hc2tUb2dnbGUiLCIkIiwiJGRlbGV0ZUFsbFJlY29yZHNCdXR0b24iLCIkZGVsZXRlQWxsTW9kYWwiLCJkZWxldGVBbGxSZWNvcmRzQUpBWFVybCIsImdsb2JhbFJvb3RVcmwiLCJkaXNhYmxlSW5wdXRNYXNrQUpBWFVybCIsImluaXRpYWxpemUiLCJtb2RhbCIsImNoZWNrYm94Iiwib25DaGFuZ2UiLCJvbkNoYW5nZUlucHV0TWFza1RvZ2dsZSIsIm9uIiwiZGVsZXRlQWxsUmVjb3JkcyIsImNsb3NhYmxlIiwib25EZW55Iiwib25BcHByb3ZlIiwiYWRkQ2xhc3MiLCJhcGkiLCJ1cmwiLCJtZXRob2QiLCJzdWNjZXNzVGVzdCIsIlBieEFwaSIsIm9uU3VjY2VzcyIsInJlc3BvbnNlIiwicmVtb3ZlQ2xhc3MiLCJVc2VyTWVzc2FnZSIsInNob3dJbmZvcm1hdGlvbiIsImdsb2JhbFRyYW5zbGF0ZSIsIm1vZHVsZV9waG5ia19BbGxSZWNvcmRzRGVsZXRlZCIsIk1vZHVsZVBob25lQm9va0RUIiwiZGF0YVRhYmxlIiwiYWpheCIsInJlbG9hZCIsIm9uRmFpbHVyZSIsInNob3dNdWx0aVN0cmluZyIsIm1lc3NhZ2VzIiwiY3VycmVudFN0YXRlIiwiZGF0YSIsImRpc2FibGVJbnB1dE1hc2siLCJ3aW5kb3ciLCJsb2NhdGlvbiIsImRvY3VtZW50IiwicmVhZHkiXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBRUEsSUFBTUEsdUJBQXVCLEdBQUc7QUFDNUJDLEVBQUFBLHVCQUF1QixFQUFFQyxDQUFDLENBQUMscUJBQUQsQ0FERTtBQUU1QkMsRUFBQUEsdUJBQXVCLEVBQUVELENBQUMsQ0FBQyxxQkFBRCxDQUZFO0FBRzVCRSxFQUFBQSxlQUFlLEVBQUVGLENBQUMsQ0FBQyx3QkFBRCxDQUhVO0FBSTVCRyxFQUFBQSx1QkFBdUIsWUFBS0MsYUFBTCx5REFKSztBQUs1QkMsRUFBQUEsdUJBQXVCLFlBQUtELGFBQUwsK0RBTEs7O0FBTzVCO0FBQ0o7QUFDQTtBQUNBO0FBQ0lFLEVBQUFBLFVBWDRCLHdCQVdmO0FBQ1Q7QUFDQVIsSUFBQUEsdUJBQXVCLENBQUNJLGVBQXhCLENBQXdDSyxLQUF4QyxDQUE4QyxNQUE5QyxFQUZTLENBSVQ7O0FBQ0FULElBQUFBLHVCQUF1QixDQUFDQyx1QkFBeEIsQ0FBZ0RTLFFBQWhELENBQXlEO0FBQ3JEQyxNQUFBQSxRQUFRLEVBQUVYLHVCQUF1QixDQUFDWTtBQURtQixLQUF6RCxFQUxTLENBU1Q7O0FBQ0FaLElBQUFBLHVCQUF1QixDQUFDRyx1QkFBeEIsQ0FBZ0RVLEVBQWhELENBQW1ELE9BQW5ELEVBQTRELFlBQVk7QUFDcEViLE1BQUFBLHVCQUF1QixDQUFDYyxnQkFBeEI7QUFDSCxLQUZEO0FBR0gsR0F4QjJCOztBQTBCNUI7QUFDSjtBQUNBO0FBQ0E7QUFDSUEsRUFBQUEsZ0JBOUI0Qiw4QkE4QlQ7QUFDZmQsSUFBQUEsdUJBQXVCLENBQUNJLGVBQXhCLENBQ0tLLEtBREwsQ0FDVztBQUNITSxNQUFBQSxRQUFRLEVBQUUsS0FEUDtBQUNjO0FBQ2pCQyxNQUFBQSxNQUFNLEVBQUUsa0JBQU07QUFDVixlQUFPLElBQVAsQ0FEVSxDQUNHO0FBQ2hCLE9BSkU7QUFLSEMsTUFBQUEsU0FBUyxFQUFFLHFCQUFNO0FBQ2JqQixRQUFBQSx1QkFBdUIsQ0FBQ0csdUJBQXhCLENBQWdEZSxRQUFoRCxDQUF5RCxTQUF6RCxFQURhLENBRWI7O0FBQ0FoQixRQUFBQSxDQUFDLENBQUNpQixHQUFGLENBQU07QUFDRkMsVUFBQUEsR0FBRyxFQUFFcEIsdUJBQXVCLENBQUNLLHVCQUQzQjtBQUVGUSxVQUFBQSxFQUFFLEVBQUUsS0FGRjtBQUdGUSxVQUFBQSxNQUFNLEVBQUUsTUFITjtBQUlGQyxVQUFBQSxXQUFXLEVBQUVDLE1BQU0sQ0FBQ0QsV0FKbEI7QUFLRkUsVUFBQUEsU0FMRSxxQkFLUUMsUUFMUixFQUtrQjtBQUNoQnpCLFlBQUFBLHVCQUF1QixDQUFDRyx1QkFBeEIsQ0FBZ0R1QixXQUFoRCxDQUE0RCxTQUE1RDtBQUNBQyxZQUFBQSxXQUFXLENBQUNDLGVBQVosQ0FBNEJDLGVBQWUsQ0FBQ0MsOEJBQTVDLEVBRmdCLENBR2hCOztBQUNBQyxZQUFBQSxpQkFBaUIsQ0FBQ0MsU0FBbEIsQ0FBNEJDLElBQTVCLENBQWlDQyxNQUFqQztBQUNILFdBVkM7QUFXRkMsVUFBQUEsU0FYRSxxQkFXUVYsUUFYUixFQVdrQjtBQUNoQnpCLFlBQUFBLHVCQUF1QixDQUFDRyx1QkFBeEIsQ0FBZ0R1QixXQUFoRCxDQUE0RCxTQUE1RCxFQURnQixDQUVoQjs7QUFDQUMsWUFBQUEsV0FBVyxDQUFDUyxlQUFaLENBQTRCWCxRQUFRLENBQUNZLFFBQXJDO0FBQ0g7QUFmQyxTQUFOO0FBaUJBLGVBQU8sSUFBUDtBQUNIO0FBMUJFLEtBRFgsRUE2Qks1QixLQTdCTCxDQTZCVyxNQTdCWCxFQURlLENBOEJLO0FBQ3ZCLEdBN0QyQjs7QUErRDVCO0FBQ0o7QUFDQTtBQUNBO0FBQ0lHLEVBQUFBLHVCQW5FNEIscUNBbUVGO0FBQ3RCLFFBQU0wQixZQUFZLEdBQUd0Qyx1QkFBdUIsQ0FBQ0MsdUJBQXhCLENBQWdEUyxRQUFoRCxDQUF5RCxZQUF6RCxDQUFyQixDQURzQixDQUd0Qjs7QUFDQVIsSUFBQUEsQ0FBQyxDQUFDaUIsR0FBRixDQUFNO0FBQ0ZDLE1BQUFBLEdBQUcsRUFBRXBCLHVCQUF1QixDQUFDTyx1QkFEM0I7QUFFRk0sTUFBQUEsRUFBRSxFQUFFLEtBRkY7QUFHRlEsTUFBQUEsTUFBTSxFQUFFLE1BSE47QUFJRmtCLE1BQUFBLElBQUksRUFBRTtBQUFFQyxRQUFBQSxnQkFBZ0IsRUFBRUY7QUFBcEIsT0FKSjtBQUtGaEIsTUFBQUEsV0FBVyxFQUFFQyxNQUFNLENBQUNELFdBTGxCO0FBTUZFLE1BQUFBLFNBTkUscUJBTVFDLFFBTlIsRUFNa0I7QUFDaEJnQixRQUFBQSxNQUFNLENBQUNDLFFBQVAsQ0FBZ0JSLE1BQWhCO0FBQ0gsT0FSQztBQVNGQyxNQUFBQSxTQVRFLHFCQVNRVixRQVRSLEVBU2tCO0FBQ2hCO0FBQ0FFLFFBQUFBLFdBQVcsQ0FBQ1MsZUFBWixDQUE0QlgsUUFBUSxDQUFDWSxRQUFyQztBQUNIO0FBWkMsS0FBTjtBQWNBLFdBQU8sSUFBUDtBQUNIO0FBdEYyQixDQUFoQyxDLENBeUZBOztBQUNBbkMsQ0FBQyxDQUFDeUMsUUFBRCxDQUFELENBQVlDLEtBQVosQ0FBa0IsWUFBTTtBQUNwQjVDLEVBQUFBLHVCQUF1QixDQUFDUSxVQUF4QjtBQUNILENBRkQiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogTWlrb1BCWCAtIGZyZWUgcGhvbmUgc3lzdGVtIGZvciBzbWFsbCBidXNpbmVzc1xuICogQ29weXJpZ2h0IMKpIDIwMTctMjAyNCBBbGV4ZXkgUG9ydG5vdiBhbmQgTmlrb2xheSBCZWtldG92XG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLlxuICogSWYgbm90LCBzZWUgPGh0dHBzOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiAqL1xuXG4vKiBnbG9iYWwgZ2xvYmFsUm9vdFVybCwgZ2xvYmFsVHJhbnNsYXRlLFxuU2VtYW50aWNMb2NhbGl6YXRpb24sIFVzZXJNZXNzYWdlLCBJbnB1dE1hc2tQYXR0ZXJucyAqL1xuXG5jb25zdCBNb2R1bGVQaG9uZUJvb2tTZXR0aW5ncyA9IHtcbiAgICAkZGlzYWJsZUlucHV0TWFza1RvZ2dsZTogJCgnI2Rpc2FibGUtaW5wdXQtbWFzaycpLFxuICAgICRkZWxldGVBbGxSZWNvcmRzQnV0dG9uOiAkKCcjZGVsZXRlLWFsbC1yZWNvcmRzJyksXG4gICAgJGRlbGV0ZUFsbE1vZGFsOiAkKCcjZGVsZXRlLWFsbC1tb2RhbC1mb3JtJyksXG4gICAgZGVsZXRlQWxsUmVjb3Jkc0FKQVhVcmw6IGAke2dsb2JhbFJvb3RVcmx9bW9kdWxlLXBob25lLWJvb2svbW9kdWxlLXBob25lLWJvb2svZGVsZXRlQWxsUmVjb3Jkc2AsXG4gICAgZGlzYWJsZUlucHV0TWFza0FKQVhVcmw6IGAke2dsb2JhbFJvb3RVcmx9bW9kdWxlLXBob25lLWJvb2svbW9kdWxlLXBob25lLWJvb2svdG9nZ2xlRGlzYWJsZUlucHV0TWFza2AsXG5cbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplIHRoZSBzZXR0aW5ncyBtb2R1bGUgZm9yIHRoZSBwaG9uZWJvb2suXG4gICAgICogSXQgc2V0cyB1cCB0aGUgZXZlbnQgbGlzdGVuZXJzIGZvciB0b2dnbGluZyBpbnB1dCBtYXNrcyBhbmQgZGVsZXRpbmcgYWxsIHJlY29yZHMuXG4gICAgICovXG4gICAgaW5pdGlhbGl6ZSgpIHtcbiAgICAgICAgLy8gSGlkZSB0aGUgZGVsZXRlIGNvbmZpcm1hdGlvbiBtb2RhbCBpbml0aWFsbHlcbiAgICAgICAgTW9kdWxlUGhvbmVCb29rU2V0dGluZ3MuJGRlbGV0ZUFsbE1vZGFsLm1vZGFsKCdoaWRlJyk7XG5cbiAgICAgICAgLy8gU2V0IHVwIHRoZSBjaGVja2JveCBmb3IgZGlzYWJsaW5nL2VuYWJsaW5nIHRoZSBpbnB1dCBtYXNrXG4gICAgICAgIE1vZHVsZVBob25lQm9va1NldHRpbmdzLiRkaXNhYmxlSW5wdXRNYXNrVG9nZ2xlLmNoZWNrYm94KHtcbiAgICAgICAgICAgIG9uQ2hhbmdlOiBNb2R1bGVQaG9uZUJvb2tTZXR0aW5ncy5vbkNoYW5nZUlucHV0TWFza1RvZ2dsZVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBBdHRhY2ggZXZlbnQgbGlzdGVuZXIgZm9yIHRoZSBcIkRlbGV0ZSBBbGwgUmVjb3Jkc1wiIGJ1dHRvblxuICAgICAgICBNb2R1bGVQaG9uZUJvb2tTZXR0aW5ncy4kZGVsZXRlQWxsUmVjb3Jkc0J1dHRvbi5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBNb2R1bGVQaG9uZUJvb2tTZXR0aW5ncy5kZWxldGVBbGxSZWNvcmRzKCk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBIYW5kbGUgdGhlIGRlbGV0aW9uIG9mIGFsbCByZWNvcmRzLlxuICAgICAqIERpc3BsYXlzIGEgY29uZmlybWF0aW9uIG1vZGFsLCBhbmQgaWYgYXBwcm92ZWQsIHNlbmRzIGEgcmVxdWVzdCB0byBkZWxldGUgYWxsIHBob25lYm9vayByZWNvcmRzLlxuICAgICAqL1xuICAgIGRlbGV0ZUFsbFJlY29yZHMoKSB7XG4gICAgICAgIE1vZHVsZVBob25lQm9va1NldHRpbmdzLiRkZWxldGVBbGxNb2RhbFxuICAgICAgICAgICAgLm1vZGFsKHtcbiAgICAgICAgICAgICAgICBjbG9zYWJsZTogZmFsc2UsIC8vIFByZXZlbnQgY2xvc2luZyB0aGUgbW9kYWwgd2l0aG91dCB1c2VyIGFjdGlvblxuICAgICAgICAgICAgICAgIG9uRGVueTogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsgLy8gQWxsb3dzIG1vZGFsIHRvIGNsb3NlIG9uIFwiQ2FuY2VsXCJcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9uQXBwcm92ZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBNb2R1bGVQaG9uZUJvb2tTZXR0aW5ncy4kZGVsZXRlQWxsUmVjb3Jkc0J1dHRvbi5hZGRDbGFzcygnbG9hZGluZycpO1xuICAgICAgICAgICAgICAgICAgICAvLyBPbiBhcHByb3ZhbCwgc2VuZCBhIHJlcXVlc3QgdG8gZGVsZXRlIGFsbCByZWNvcmRzXG4gICAgICAgICAgICAgICAgICAgICQuYXBpKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogTW9kdWxlUGhvbmVCb29rU2V0dGluZ3MuZGVsZXRlQWxsUmVjb3Jkc0FKQVhVcmwsXG4gICAgICAgICAgICAgICAgICAgICAgICBvbjogJ25vdycsXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NUZXN0OiBQYnhBcGkuc3VjY2Vzc1Rlc3QsXG4gICAgICAgICAgICAgICAgICAgICAgICBvblN1Y2Nlc3MocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNb2R1bGVQaG9uZUJvb2tTZXR0aW5ncy4kZGVsZXRlQWxsUmVjb3Jkc0J1dHRvbi5yZW1vdmVDbGFzcygnbG9hZGluZycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFVzZXJNZXNzYWdlLnNob3dJbmZvcm1hdGlvbihnbG9iYWxUcmFuc2xhdGUubW9kdWxlX3BobmJrX0FsbFJlY29yZHNEZWxldGVkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZWxvYWQgdGhlIHBhZ2UgYWZ0ZXIgc3VjY2Vzc2Z1bCB1cGRhdGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNb2R1bGVQaG9uZUJvb2tEVC5kYXRhVGFibGUuYWpheC5yZWxvYWQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBvbkZhaWx1cmUocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNb2R1bGVQaG9uZUJvb2tTZXR0aW5ncy4kZGVsZXRlQWxsUmVjb3Jkc0J1dHRvbi5yZW1vdmVDbGFzcygnbG9hZGluZycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNob3cgZXJyb3IgbWVzc2FnZSBpZiBkZWxldGlvbiBmYWlsc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFVzZXJNZXNzYWdlLnNob3dNdWx0aVN0cmluZyhyZXNwb25zZS5tZXNzYWdlcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAubW9kYWwoJ3Nob3cnKTsgLy8gRGlzcGxheSB0aGUgY29uZmlybWF0aW9uIG1vZGFsXG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEhhbmRsZSB0aGUgdG9nZ2xlIG9mIHRoZSBpbnB1dCBtYXNrLlxuICAgICAqIFNlbmRzIGEgcmVxdWVzdCB0byB1cGRhdGUgdGhlIHNldHRpbmcgZm9yIGVuYWJsaW5nIG9yIGRpc2FibGluZyBpbnB1dCBtYXNrcy5cbiAgICAgKi9cbiAgICBvbkNoYW5nZUlucHV0TWFza1RvZ2dsZSgpIHtcbiAgICAgICAgY29uc3QgY3VycmVudFN0YXRlID0gTW9kdWxlUGhvbmVCb29rU2V0dGluZ3MuJGRpc2FibGVJbnB1dE1hc2tUb2dnbGUuY2hlY2tib3goJ2lzIGNoZWNrZWQnKTtcblxuICAgICAgICAvLyBTZW5kIHJlcXVlc3QgdG8gdG9nZ2xlIHRoZSBpbnB1dCBtYXNrIHNldHRpbmdcbiAgICAgICAgJC5hcGkoe1xuICAgICAgICAgICAgdXJsOiBNb2R1bGVQaG9uZUJvb2tTZXR0aW5ncy5kaXNhYmxlSW5wdXRNYXNrQUpBWFVybCxcbiAgICAgICAgICAgIG9uOiAnbm93JyxcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgZGF0YTogeyBkaXNhYmxlSW5wdXRNYXNrOiBjdXJyZW50U3RhdGUgfSxcbiAgICAgICAgICAgIHN1Y2Nlc3NUZXN0OiBQYnhBcGkuc3VjY2Vzc1Rlc3QsXG4gICAgICAgICAgICBvblN1Y2Nlc3MocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25GYWlsdXJlKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgLy8gU2hvdyBlcnJvciBtZXNzYWdlIGlmIHRoZSB1cGRhdGUgZmFpbHNcbiAgICAgICAgICAgICAgICBVc2VyTWVzc2FnZS5zaG93TXVsdGlTdHJpbmcocmVzcG9uc2UubWVzc2FnZXMpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0sXG59O1xuXG4vLyBJbml0aWFsaXplIHRoZSBzZXR0aW5ncyBtb2R1bGUgd2hlbiB0aGUgZG9jdW1lbnQgaXMgcmVhZHlcbiQoZG9jdW1lbnQpLnJlYWR5KCgpID0+IHtcbiAgICBNb2R1bGVQaG9uZUJvb2tTZXR0aW5ncy5pbml0aWFsaXplKCk7XG59KTsiXX0=